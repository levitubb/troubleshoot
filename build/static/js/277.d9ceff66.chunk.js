"use strict";(globalThis.webpackChunk_stlite_desktop=globalThis.webpackChunk_stlite_desktop||[]).push([[277],{77390:(e,t,i)=>{i.d(t,{$:()=>g,Z:()=>p});var s=i(5057),n=i(31476),a=i(63),l=i(99362),r=i(16449),o=i(80099),d=i(96266);let g;!function(e){e.EXTRASMALL="xs",e.SMALL="sm",e.MEDIUM="md",e.LARGE="lg",e.EXTRALARGE="xl"}(g||(g={}));const p=function({value:e,width:t,size:i=g.SMALL,overrides:p}){const c=(0,n.u)(),h={xs:c.spacing.twoXS,sm:c.spacing.sm,md:c.spacing.lg,lg:c.spacing.xl,xl:c.spacing.twoXL},{activeTheme:m}=s.useContext(a.I),u=!(0,l.MJ)(m),x={BarContainer:{style:{marginTop:c.spacing.none,marginBottom:c.spacing.none,marginRight:c.spacing.none,marginLeft:c.spacing.none}},Bar:{style:({$theme:e})=>({width:t?t.toString():void 0,marginTop:c.spacing.none,marginBottom:c.spacing.none,marginRight:c.spacing.none,marginLeft:c.spacing.none,height:h[i],backgroundColor:e.colors.progressbarTrackFill,borderTopLeftRadius:c.spacing.twoXS,borderTopRightRadius:c.spacing.twoXS,borderBottomLeftRadius:c.spacing.twoXS,borderBottomRightRadius:c.spacing.twoXS})},BarProgress:{style:()=>({backgroundColor:u?c.colors.primary:c.colors.blue70,borderTopLeftRadius:c.spacing.twoXS,borderTopRightRadius:c.spacing.twoXS,borderBottomLeftRadius:c.spacing.twoXS,borderBottomRightRadius:c.spacing.twoXS})}};return(0,d.jsx)(r.Z,{value:e,overrides:(0,o.aO)(x,p)})}},41605:(e,t,i)=>{i.d(t,{R:()=>s});class s{setStatus(e){return new s(this.name,this.size,this.id,e)}constructor(e,t,i,s){this.name=void 0,this.size=void 0,this.status=void 0,this.id=void 0,this.name=e,this.size=t,this.id=i,this.status=s}}},277:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ge});var s=i(10458),n=i.n(s),a=i(65873),l=i.n(a),r=i(5057),o=i(32291),d=i(56846),g=i(34422);let p;!function(e){e.Gigabyte="gb",e.Megabyte="mb",e.Kilobyte="kb",e.Byte="b"}(p||(p={}));const c=(0,g.rA)()?1024:1e3,h=[p.Gigabyte,p.Megabyte,p.Kilobyte,p.Byte],m=(e,t,i=1)=>{if(t||(t=p.Byte),i<0&&(i=0),e<0)throw new Error("Size must be greater than or equal to 0");const s=h.indexOf(t);return s&&e>c/2?m(e/c,h[s-1],i):`${e.toFixed(i)}${t.toUpperCase()}`};var u=i(86964),x=i(8429),f=i(54840),v=i(71096),y=i(92445),S=i(45490);const b=(0,S.Z)("section",{target:"exg6vvm15"})((({isDisabled:e,theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.lg,backgroundColor:t.colors.secondaryBg,borderRadius:t.radii.md,":focus":{outline:"none",boxShadow:`0 0 0 1px ${t.colors.primary}`},color:e?t.colors.gray:t.colors.bodyText})),""),w=(0,S.Z)("div",{target:"exg6vvm14"})((()=>({marginRight:"auto",alignItems:"center",display:"flex"})),""),F=(0,S.Z)("span",{target:"exg6vvm13"})((({theme:e})=>({color:e.colors.darkenedBgMix100,marginRight:e.spacing.lg})),""),j=(0,S.Z)("span",{target:"exg6vvm12"})((({theme:e})=>({marginBottom:e.spacing.twoXS})),""),I=(0,S.Z)("div",{target:"exg6vvm11"})({name:"1fttcpj",styles:"display:flex;flex-direction:column"}),z=(0,S.Z)("div",{target:"exg6vvm10"})((({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingTop:e.spacing.md,paddingLeft:e.spacing.lg,paddingRight:e.spacing.lg})),""),B=(0,S.Z)("ul",{target:"exg6vvm9"})((()=>({listStyleType:"none",marginBottom:0})),""),M=(0,S.Z)("li",{target:"exg6vvm8"})((({theme:e})=>({margin:e.spacing.none,padding:e.spacing.none})),""),L=(0,S.Z)("div",{target:"exg6vvm7"})((({theme:e})=>({display:"flex",alignItems:"baseline",flex:1,paddingLeft:e.spacing.lg,overflow:"hidden"})),""),Z=(0,S.Z)("div",{target:"exg6vvm6"})((({theme:e})=>({marginRight:e.spacing.sm,marginBottom:e.spacing.twoXS,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"})),""),R=(0,S.Z)("div",{target:"exg6vvm5"})((({theme:e})=>({display:"flex",alignItems:"center",marginBottom:e.spacing.twoXS})),""),C=(0,S.Z)("span",{target:"exg6vvm4"})((({theme:e})=>({marginRight:e.spacing.twoXS})),""),k=(0,S.Z)("div",{target:"exg6vvm3"})((({theme:e})=>({display:"flex",padding:e.spacing.twoXS,color:e.colors.darkenedBgMix100})),""),U=(0,S.Z)("small",{target:"exg6vvm2"})((({theme:e})=>({color:e.colors.danger,fontSize:e.fontSizes.sm,height:e.fontSizes.sm,lineHeight:e.fontSizes.sm,display:"flex",alignItems:"center",whiteSpace:"nowrap"})),""),P=(0,S.Z)("span",{target:"exg6vvm1"})({name:"0",styles:""}),T=e=>({[b]:{display:"flex",flexDirection:"column",alignItems:"flex-start"},[w]:{marginBottom:e.spacing.lg},[F]:{display:"none"},[z]:{paddingRight:e.spacing.lg},[R]:{maxWidth:"inherit",flex:1,alignItems:"flex-start",marginBottom:e.spacing.sm},[Z]:{width:e.sizes.full},[L]:{flexDirection:"column"},[U]:{height:"auto",whiteSpace:"initial"},[P]:{display:"none"},[M]:{margin:e.spacing.none,padding:e.spacing.none}}),X=(0,S.Z)("div",{target:"exg6vvm0"})((({theme:e})=>e.inSidebar?T(e):{[`@media (max-width: ${e.breakpoints.sm})`]:T(e)}),"");var D=i(44071),E=i(97292),A=i(10786),N=i(96266);const $=({multiple:e,acceptedExtensions:t,maxSizeBytes:i})=>(0,N.jsxs)(w,{children:[(0,N.jsx)(F,{children:(0,N.jsx)(E.ZP,{content:D.n,size:"threeXL"})}),(0,N.jsxs)(I,{children:[(0,N.jsxs)(j,{children:["Drag and drop file",e?"s":""," here"]}),(0,N.jsxs)(A.x,{children:[`Limit ${m(i,p.Byte,0)} per file`,t.length?` \u2022 ${t.join(", ").replace(/\./g,"").toUpperCase()}`:null]})]})]}),V=({onDrop:e,multiple:t,acceptedExtensions:i,maxSizeBytes:s,disabled:n,label:a})=>(0,N.jsx)(v.ZP,{onDrop:e,multiple:t,accept:i.length?i:void 0,maxSize:s,disabled:n,useFsAccessApi:!1,children:({getRootProps:e,getInputProps:l})=>(0,N.jsxs)(b,{...e(),"data-testid":"stFileUploadDropzone",isDisabled:n,"aria-label":a,children:[(0,N.jsx)("input",{...l()}),(0,N.jsx)($,{multiple:t,acceptedExtensions:i,maxSizeBytes:s}),(0,N.jsx)(y.ZP,{kind:y.hY.SECONDARY,disabled:n,size:y.$u.SMALL,children:"Browse files"})]})});var O=i(56129),H=i.n(O),_=i(75427),G=i(5642);const W=(0,S.Z)("div",{target:"e1f8s2qs1"})((({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",paddingBottom:e.spacing.twoXS,marginBottom:e.spacing.twoXS})),""),Y=(0,S.Z)("div",{target:"e1f8s2qs0"})((({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"center",color:e.colors.fadedText40})),""),q=({className:e,currentPage:t,totalPages:i,onNext:s,onPrevious:n})=>(0,N.jsxs)(W,{className:e,children:[(0,N.jsx)(A.x,{children:`Showing page ${t} of ${i}`}),(0,N.jsxs)(Y,{children:[(0,N.jsx)(y.ZP,{onClick:n,kind:y.hY.MINIMAL,children:(0,N.jsx)(E.ZP,{content:_.s,size:"xl"})}),(0,N.jsx)(y.ZP,{onClick:s,kind:y.hY.MINIMAL,children:(0,N.jsx)(E.ZP,{content:G._,size:"xl"})})]})]});var K=i(36300);const J=(e,t)=>Math.ceil(e.length/t),Q=e=>H()((({pageSize:t,items:i,resetOnAdd:s,...n})=>{const[a,l]=(0,r.useState)(0),[o,d]=(0,r.useState)(J(i,t)),g=(0,K.D)(i);(0,r.useEffect)((()=>{g&&g.length!==i.length&&d(J(i,t)),g&&g.length<i.length?s&&l(0):a+1>=o&&l(o-1)}),[i,a,t,g,s,o]);const p=i.slice(a*t,a*t+t);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(e,{items:p,...n}),i.length>t?(0,N.jsx)(q,{className:"streamlit-paginator",pageSize:t,totalPages:o,currentPage:a+1,onNext:()=>{l(Math.min(a+1,o-1))},onPrevious:()=>{l(Math.max(0,a-1))}}):null]})}),e);var ee=i(15766),te=i(31906),ie=i(13324),se=i(77390);const ne=({fileInfo:e})=>"uploading"===e.status.type?(0,N.jsx)(se.Z,{value:e.status.progress,size:se.$.SMALL,overrides:{Bar:{style:{marginLeft:0,marginTop:"4px"}}}}):"error"===e.status.type?(0,N.jsxs)(U,{children:[(0,N.jsx)(C,{"data-testid":"stUploadedFileErrorMessage",children:e.status.errorMessage}),(0,N.jsx)(P,{children:(0,N.jsx)(E.ZP,{content:ee.j,size:"lg"})})]}):"uploaded"===e.status.type?(0,N.jsx)(A.x,{children:m(e.size,p.Byte)}):null,ae=({fileInfo:e,onDelete:t})=>(0,N.jsxs)(R,{className:"uploadedFile",children:[(0,N.jsx)(k,{children:(0,N.jsx)(E.ZP,{content:te.h,size:"twoXL"})}),(0,N.jsxs)(L,{className:"uploadedFileData",children:[(0,N.jsx)(Z,{className:"uploadedFileName",title:e.name,children:e.name}),(0,N.jsx)(ne,{fileInfo:e})]}),(0,N.jsx)("div",{"data-testid":"fileDeleteBtn",children:(0,N.jsx)(y.ZP,{onClick:()=>t(e.id),kind:y.hY.MINIMAL,children:(0,N.jsx)(E.ZP,{content:ie.U,size:"lg"})})})]}),le=Q((({items:e,onDelete:t})=>(0,N.jsx)(B,{children:e.map((e=>(0,N.jsx)(M,{children:(0,N.jsx)(ae,{fileInfo:e,onDelete:t})},e.id)))}))),re=e=>(0,N.jsx)(z,{children:(0,N.jsx)(le,{...e})});var oe=i(41605);class de extends r.PureComponent{constructor(e){super(e),this.formClearHelper=new d.Kz,this.localFileIdCounter=1,this.componentDidUpdate=e=>{const{element:t,widgetMgr:i}=this.props;if(e.disabled!==this.props.disabled&&this.props.disabled)return this.reset(),void i.setFileUploaderStateValue(t,new o.xO,{fromUi:!1});if("ready"!==this.status)return;const s=this.createWidgetValue();if(void 0===s)return;const n=i.getFileUploaderStateValue(t);l().isEqual(s,n)||i.setFileUploaderStateValue(t,s,{fromUi:!0})},this.reset=()=>{this.setState({files:[]})},this.dropHandler=(e,t)=>{const{element:i}=this.props,{multipleFiles:s}=i;if(!s&&0===e.length&&t.length>1){const i=t.findIndex((e=>1===e.errors.length&&"too-many-files"===e.errors[0].code));i>=0&&(e.push(t[i].file),t.splice(i,1))}if(!s&&e.length>0&&this.state.files.length>0&&this.removeFile(this.state.files[0].id),e.forEach(this.uploadFile),t.length>0){const e=t.map((e=>{const{file:t}=e;return new oe.R(t.name,t.size,this.nextLocalFileId(),{type:"error",errorMessage:this.getErrorMessage(e.errors[0].code,e.file)})}));this.addFiles(e)}},this.uploadFile=e=>{const t=n().CancelToken.source(),i=new oe.R(e.name,e.size,this.nextLocalFileId(),{type:"uploading",cancelToken:t,progress:1});this.addFile(i),this.props.uploadClient.uploadFile(this.props.element,e,(e=>this.onUploadProgress(e,i.id)),t.token).then((e=>this.onUploadComplete(i.id,e))).catch((e=>{n().isCancel(e)||this.updateFile(i.id,i.setStatus({type:"error",errorMessage:e?e.toString():"Unknown error"}))}))},this.onUploadComplete=(e,t)=>{this.setState((e=>({newestServerFileId:Math.max(e.newestServerFileId,t)})));const i=this.getFile(e);null!=i&&"uploading"===i.status.type&&this.updateFile(i.id,i.setStatus({type:"uploaded",serverFileId:t}))},this.getErrorMessage=(e,t)=>{switch(e){case"file-too-large":return`File must be ${m(this.maxUploadSizeInBytes,p.Byte)} or smaller.`;case"file-invalid-type":return`${t.type} files are not allowed.`;case"file-too-small":return"File size is too small.";case"too-many-files":return"Only one file is allowed.";default:return"Unexpected error. Please try again."}},this.deleteFile=e=>{const t=this.getFile(e);null!=t&&("uploading"===t.status.type&&t.status.cancelToken.cancel(),this.removeFile(e))},this.addFile=e=>{this.setState((t=>({files:[...t.files,e]})))},this.addFiles=e=>{this.setState((t=>({files:[...t.files,...e]})))},this.removeFile=e=>{this.setState((t=>({files:t.files.filter((t=>t.id!==e))})))},this.getFile=e=>this.state.files.find((t=>t.id===e)),this.updateFile=(e,t)=>{this.setState((i=>({files:i.files.map((i=>i.id===e?t:i))})))},this.onUploadProgress=(e,t)=>{const i=this.getFile(t);if(null==i||"uploading"!==i.status.type)return;const s=Math.round(100*e.loaded/e.total);i.status.progress!==s&&this.updateFile(t,i.setStatus({type:"uploading",cancelToken:i.status.cancelToken,progress:s}))},this.onFormCleared=()=>{this.setState({files:[]},(()=>{const e=this.createWidgetValue();null!=e&&this.props.widgetMgr.setFileUploaderStateValue(this.props.element,e,{fromUi:!0})}))},this.state=this.initialValue}get initialValue(){const e={files:[],newestServerFileId:0},{widgetMgr:t,element:i}=this.props,s=t.getFileUploaderStateValue(i);if(null==s)return e;const{maxFileId:n,uploadedFileInfo:a}=s;return null==n||0===n||null==a?e:{files:a.map((e=>{const t=e.name,i=e.size,s=e.id;return new oe.R(t,i,this.nextLocalFileId(),{type:"uploaded",serverFileId:s})})),newestServerFileId:Number(n)}}componentWillUnmount(){this.formClearHelper.disconnect()}get maxUploadSizeInBytes(){return((e,t,i)=>{if(e<0)throw Error("Size must be 0 or greater");const s=h.findIndex((e=>e===t)),n=h.findIndex((e=>e===i));if(-1===s||-1===n)throw Error("Unexpected byte unit provided");if(s===n)return e;const a=Math.abs(s-n),l=c**a;return s>n?e/l:e*l})(this.props.element.maxUploadSizeMb,p.Megabyte,p.Byte)}get status(){return this.state.files.some((e=>"uploading"===e.status.type))?"updating":"ready"}createWidgetValue(){if(0===this.state.newestServerFileId)return;const e=this.state.files.filter((e=>"uploaded"===e.status.type)).map((e=>{const{name:t,size:i,status:s}=e;return new o.jM({id:s.serverFileId,name:t,size:i})}));return new o.xO({maxFileId:this.state.newestServerFileId,uploadedFileInfo:e})}render(){var e;const{files:t}=this.state,{element:i,disabled:s,widgetMgr:n}=this.props,a=i.type;this.formClearHelper.manageFormClearListener(n,i.formId,this.onFormCleared);const l=t.slice().reverse();return(0,N.jsxs)(X,{"data-testid":"stFileUploader",children:[(0,N.jsx)(u.ON,{label:i.label,disabled:s,labelVisibility:(0,g.iF)(null===(e=i.labelVisibility)||void 0===e?void 0:e.value),children:i.help&&(0,N.jsx)(u.dT,{children:(0,N.jsx)(x.ZP,{content:i.help,placement:f.ug.TOP_RIGHT})})}),(0,N.jsx)(V,{onDrop:this.dropHandler,multiple:i.multipleFiles,acceptedExtensions:a,maxSizeBytes:this.maxUploadSizeInBytes,label:i.label,disabled:s}),l.length>0&&(0,N.jsx)(re,{items:l,pageSize:3,onDelete:this.deleteFile,resetOnAdd:!0})]})}nextLocalFileId(){return this.localFileIdCounter++}}const ge=de}}]);